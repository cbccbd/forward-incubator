-- 1.

SELECT COUNT(*) AS ATTEMPTS 
FROM fw_process_log 

WHERE fw_process_log.N_STATUS = 500

AND fw_process_log.V_MESSAGE LIKE '%2520123%';

-- 2.
SELECT DDMMYYYY, '2520123' N_ORDER 

FROM (SELECT 
TO_CHAR(DT_TIMESTAMP, 'DD-MON-YYYY') AS DDMMYYYY 

FROM fw_process_log 

WHERE fw_process_log.N_STATUS = 500 
AND fw_process_log.V_MESSAGE LIKE '%2520123%'

ORDER BY fw_process_log.DT_TIMESTAMP DESC)

FETCH NEXT 1 ROWS ONLY;

-- 3.1 если значения "-1" нужны

SELECT to_char(substr(V_MESSAGE, 35)) N_ORDERS

FROM fw_process_log

WHERE fw_process_log.V_MESSAGE LIKE '%Загрузка порции%'

GROUP BY V_MESSAGE;

--3.2 если значения "-1" не нужны
SELECT * 
FROM (SELECT to_char(substr(V_MESSAGE, 35)) N_ORDERS
FROM fw_process_log

WHERE fw_process_log.V_MESSAGE LIKE '%Загрузка порции%'

GROUP BY V_MESSAGE)

WHERE length(N_ORDERS)>2;

--4. (без "-1")
SELECT length(N_ORDERS) ORDERS_COUNT

FROM (SELECT to_char(substr(V_MESSAGE, 35)) N_ORDERS

FROM fw_process_log


WHERE fw_process_log.V_MESSAGE LIKE '%Загрузка порции%'


GROUP BY V_MESSAGE)


WHERE length(N_ORDERS)>2

FETCH NEXT 1 ROWS ONLY;

--5.
SELECT SUM(TO_NUMBER(to_char(substr(V_MESSAGE, 140))))

AS TOTAL_MILISECOND_TO_MOVE

FROM fw_process_log

WHERE N_ACTION = 11;

--6.
SELECT count(*) AS COMPLETE_PROCESSES

FROM fw_process_log

WHERE N_ACTION = 11

AND DT_TIMESTAMP >= TO_DATE('01-MAR-2018', 'DD-MON-YYYY')

AND DT_TIMESTAMP <= TO_DATE('31-MAR-2018', 'DD-MON-YYYY');

--7.
SELECT LENGTH(CNT) AMNT 

FROM (SELECT SID, COUNT(*) CNT FROM fw_process_log GROUP BY SID)

WHERE CNT > 1;

--8.1 если под логином имелся в виду OS_USERNAME
SELECT DT_TIMESTAMP, OS_USERNAME

FROM fw_process_log

WHERE ID_USER = 11136

ORDER BY DT_TIMESTAMP DESC

FETCH NEXT 1 ROWS ONLY;

--8.2 если логин записан в V_MESSAGE
SELECT DT_TIMESTAMP, to_char(substr(V_MESSAGE, 14, 10)) LOGIN

FROM fw_process_log

WHERE ID_USER = 11136

ORDER BY DT_TIMESTAMP DESC

FETCH NEXT 1 ROWS ONLY;

--9.
SELECT TO_CHAR(DT_TIMESTAMP, 'MONTH') AS MONTH, 
count(*) AS AMNT

FROM fw_process_log

GROUP BY TO_CHAR(DT_TIMESTAMP, 'MONTH');

--10.
SELECT COUNT(*) ALL_ROWS, COUNT(DISTINCT V_MESSAGE) UNIQUE_ROWS

FROM fw_process_log

WHERE ID_PROCESS = 5

AND N_STATUS = 500

AND DT_TIMESTAMP > TO_DATE('22.02.2018', 'DD.MM.YYYY')

AND DT_TIMESTAMP < TO_DATE('02.03.2018', 'DD.MM.YYYY');

--11.
SELECT N_SUM

FROM fw_transfers

WHERE DT_INCOMING >= TO_DATE('14.02.2017.10.00', 'DD.MM.YYYY.HH.MI')

AND DT_INCOMING < TO_DATE('14.02.2017.12.00', 'DD.MM.YYYY.HH.MI')

AND ID_CONTRACT_FROM != ID_CONTRACT_TO
ORDER BY N_SUM

FETCH NEXT 1 ROWS ONLY;

--12.
SELECT ID_CONTRACT_TO, DT_REAL, LENGTH(V_DESCRIPTION)-20 LEN

FROM fw_transfers

WHERE LENGTH(V_DESCRIPTION) > 20

ORDER BY LEN DESC;

--13.
SELECT TO_CHAR(DT_INCOMING, 'DD.MM.YYYY') DT_DATE, COUNT(*) TRANSFERS

FROM fw_transfers

WHERE ID_CONTRACT_FROM = ID_CONTRACT_TO

GROUP BY TO_CHAR(DT_INCOMING, 'DD.MM.YYYY');